<!-- ui/command_deck.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friday AI - Command Deck</title>
    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --critical-color: #c0392b;
            --muted-color: #7f8c8d;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        header {
            background-color: var(--panel-bg);
            padding: 1rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1, h2, h3 {
            margin: 0;
            font-weight: 500;
        }
        
        .content {
            padding: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1rem;
        }
        
        .panel {
            background-color: var(--panel-bg);
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid #333;
            padding-bottom: 0.5rem;
        }
        
        .panel-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .panel-content {
            overflow: auto;
            max-height: 400px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-running {
            background-color: var(--success-color);
        }
        
        .status-warning {
            background-color: var(--warning-color);
        }
        
        .status-error {
            background-color: var(--error-color);
        }
        
        .status-critical {
            background-color: var(--critical-color);
        }
        
        .status-unknown {
            background-color: var(--muted-color);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .metric-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 500;
            margin: 0.5rem 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: var(--muted-color);
        }
        
        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid #333;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            font-size: 0.8rem;
            color: var(--muted-color);
        }
        
        .log-message {
            margin-top: 0.25rem;
        }
        
        .log-warning {
            border-left: 3px solid var(--warning-color);
            padding-left: 0.5rem;
        }
        
        .log-error {
            border-left: 3px solid var(--error-color);
            padding-left: 0.5rem;
        }
        
        .log-critical {
            border-left: 3px solid var(--critical-color);
            padding-left: 0.5rem;
            background-color: rgba(192, 57, 43, 0.1);
        }
        
        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.danger {
            background-color: var(--error-color);
        }
        
        button.danger:hover {
            background-color: #c0392b;
        }
        
        .chart-container {
            width: 100%;
            height: 200px;
            margin-top: 1rem;
        }
        
        .refresh-info {
            font-size: 0.8rem;
            color: var(--muted-color);
            margin-top: 1rem;
            text-align: center;
        }
        
        .error-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .memory-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .memory-tier {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.05);
            margin: 0 0.25rem;
        }
        
        .memory-tier-label {
            font-size: 0.8rem;
            color: var(--muted-color);
        }
        
        .memory-tier-value {
            font-size: 1.2rem;
            margin: 0.25rem 0;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Friday AI - Command Deck</h1>
            <div id="system-status">
                <span id="status-indicator" class="status-indicator status-unknown"></span>
                <span id="status-text">Connecting...</span>
            </div>
        </div>
        <div>
            <button id="refresh-btn">Refresh</button>
            <button id="diagnostics-btn">Run Diagnostics</button>
        </div>
    </header>
    
    <div class="content">
        <!-- System Metrics Panel -->
        <div class="panel" id="system-metrics-panel">
            <div class="panel-header">
                <h2>System Resources</h2>
                <div class="panel-controls">
                    <span id="system-metrics-status" class="status-indicator status-unknown"></span>
                    <button id="toggle-metrics-btn" class="small">Collapse</button>
                </div>
            </div>
            <div class="panel-content">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">CPU Usage</div>
                        <div class="metric-value" id="cpu-usage">0%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Memory Usage</div>
                        <div class="metric-value" id="memory-usage">0%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Disk Usage</div>
                        <div class="metric-value" id="disk-usage">0%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Friday Process</div>
                        <div class="metric-value" id="process-memory">0 MB</div>
                    </div>
                </div>
                
                <div class="chart-container" id="cpu-chart">
                    <!-- CPU Chart will be inserted here -->
                </div>
                
                <div class="chart-container" id="memory-chart">
                    <!-- Memory Chart will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Memory Access Panel -->
        <div class="panel" id="memory-access-panel">
            <div class="panel-header">
                <h2>Memory Access</h2>
                <div class="panel-controls">
                    <span id="memory-access-status" class="status-indicator status-unknown"></span>
                    <button id="toggle-memory-btn" class="small">Collapse</button>
                </div>
            </div>
            <div class="panel-content">
                <div class="memory-stats">
                    <div class="memory-tier">
                        <div class="memory-tier-label">Short-term</div>
                        <div class="memory-tier-value" id="short-term-count">-</div>
                    </div>
                    <div class="memory-tier">
                        <div class="memory-tier-label">Mid-term</div>
                        <div class="memory-tier-value" id="mid-term-count">-</div>
                    </div>
                    <div class="memory-tier">
                        <div class="memory-tier-label">Long-term</div>
                        <div class="memory-tier-value" id="long-term-count">-</div>
                    </div>
                </div>
                
                <h3>Recent Memory Operations</h3>
                <div id="memory-access-logs" class="error-list">
                    <!-- Memory logs will be inserted here -->
                </div>
                
                <h3>Memory Errors</h3>
                <div id="memory-error-logs" class="error-list">
                    <!-- Memory error logs will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Error Tracking Panel -->
        <div class="panel" id="error-tracking-panel">
            <div class="panel-header">
                <h2>Error Tracking</h2>
                <div class="panel-controls">
                    <span id="error-tracking-status" class="status-indicator status-unknown"></span>
                    <button id="toggle-errors-btn" class="small">Collapse</button>
                </div>
            </div>
            <div class="panel-content">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Critical Errors</div>
                        <div class="metric-value" id="critical-count">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Errors</div>
                        <div class="metric-value" id="error-count">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Warnings</div>
                        <div class="metric-value" id="warning-count">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Log Files</div>
                        <div class="metric-value" id="log-file-count">0</div>
                    </div>
                </div>
                
                <h3>Recent Errors</h3>
                <div id="error-logs" class="error-list">
                    <!-- Error logs will be inserted here -->
                </div>
                
                <div class="refresh-info">
                    <button id="clear-errors-btn" class="danger">Clear Errors</button>
                </div>
            </div>
        </div>
        
        <!-- Component Status Panel -->
        <div class="panel" id="component-status-panel">
            <div class="panel-header">
                <h2>Component Status</h2>
                <div class="panel-controls">
                    <button id="toggle-components-btn" class="small">Collapse</button>
                </div>
            </div>
            <div class="panel-content">
                <div id="component-list">
                    <!-- Component status will be inserted here -->
                </div>
                
                <div class="refresh-info">
                    Last updated: <span id="last-update-time">Never</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Dashboard configuration
        const config = {
            refreshInterval: 5000, // ms
            apiEndpoint: '/api',
            charts: {},
            lastUpdate: null,
            componentStatus: {}
        };
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Initial data fetch
            fetchDashboardData();
            
            // Set up refresh interval
            setInterval(fetchDashboardData, config.refreshInterval);
            
            // Set up button handlers
            document.getElementById('refresh-btn').addEventListener('click', fetchDashboardData);
            document.getElementById('diagnostics-btn').addEventListener('click', runDiagnostics);
            document.getElementById('clear-errors-btn').addEventListener('click', clearErrors);
            
            // Toggle panel visibility
            document.getElementById('toggle-metrics-btn').addEventListener('click', function() {
                togglePanel('system-metrics-panel', this);
            });
            
            document.getElementById('toggle-memory-btn').addEventListener('click', function() {
                togglePanel('memory-access-panel', this);
            });
            
            document.getElementById('toggle-errors-btn').addEventListener('click', function() {
                togglePanel('error-tracking-panel', this);
            });
            
            document.getElementById('toggle-components-btn').addEventListener('click', function() {
                togglePanel('component-status-panel', this);
            });
            
            // Initialize charts
            initializeCharts();
        });
        
        // Fetch dashboard data from API
        async function fetchDashboardData() {
            try {
                // Update system info
                const systemInfoResponse = await fetch(`${config.apiEndpoint}/system_info`);
                if (systemInfoResponse.ok) {
                    const systemInfo = await systemInfoResponse.json();
                    updateSystemInfo(systemInfo.data);
                }
                
                // Update dashboard panels
                const dashboardResponse = await fetch(`${config.apiEndpoint}/dashboard`);
                if (dashboardResponse.ok) {
                    const dashboardData = await dashboardResponse.json();
                    updateDashboardPanels(dashboardData.data);
                }
                
                // Update last fetch time
                config.lastUpdate = new Date();
                document.getElementById('last-update-time').innerText = config.lastUpdate.toLocaleTimeString();
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                updateSystemStatus('error', 'Connection error');
            }
        }
        
        // Update system status info
        function updateSystemInfo(data) {
            if (!data) return;
            
            // Update system status indicator
            updateSystemStatus(data.friday.status, 'System running');
            
            // Update component status
            config.componentStatus = data.friday.component_status;
            updateComponentList();
        }
        
        // Update all dashboard panels
        function updateDashboardPanels(data) {
            if (!data || !data.panels) return;
            
            // Update system metrics panel
            if (data.panels.system_metrics) {
                updateSystemMetricsPanel(data.panels.system_metrics);
            }
            
            // Update memory access panel
            if (data.panels.memory_access) {
                updateMemoryAccessPanel(data.panels.memory_access);
            }
            
            // Update error tracking panel
            if (data.panels.error_tracker) {
                updateErrorTrackingPanel(data.panels.error_tracker);
            }
        }
        
        // Update system status indicator
        function updateSystemStatus(status, message) {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // Remove all status classes
            indicator.className = 'status-indicator';
            
            // Add appropriate class
            switch (status) {
                case 'running':
                    indicator.classList.add('status-running');
                    break;
                case 'warning':
                    indicator.classList.add('status-warning');
                    break;
                case 'error':
                    indicator.classList.add('status-error');
                    break;
                case 'critical':
                    indicator.classList.add('status-critical');
                    break;
                default:
                    indicator.classList.add('status-unknown');
            }
            
            // Update status text
            statusText.innerText = message || status;
        }
        
        // Update component status list
        function updateComponentList() {
            const componentList = document.getElementById('component-list');
            componentList.innerHTML = '';
            
            for (const [componentId, status] of Object.entries(config.componentStatus)) {
                const componentItem = document.createElement('div');
                componentItem.className = 'log-entry';
                
                // Add status indicator class based on status
                if (status.status === 'error' || status.status === 'critical') {
                    componentItem.classList.add('log-error');
                } else if (status.status === 'warning' || status.status === 'stalled') {
                    componentItem.classList.add('log-warning');
                }
                
                // Create component content
                const statusIndicator = document.createElement('span');
                statusIndicator.className = `status-indicator status-${status.status || 'unknown'}`;
                
                const componentName = document.createElement('strong');
                componentName.innerText = componentId;
                
                const componentStatus = document.createElement('span');
                componentStatus.innerText = `: ${status.status || 'unknown'}`;
                
                componentItem.appendChild(statusIndicator);
                componentItem.appendChild(componentName);
                componentItem.appendChild(componentStatus);
                
                // Add error message if present
                if (status.error) {
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'log-message';
                    errorMessage.innerText = status.error;
                    componentItem.appendChild(errorMessage);
                }
                
                // Add control buttons
                const controlsDiv = document.createElement('div');
                controlsDiv.style.marginTop = '0.5rem';
                
                const restartBtn = document.createElement('button');
                restartBtn.innerText = 'Restart';
                restartBtn.style.fontSize = '0.8rem';
                restartBtn.style.padding = '0.25rem 0.5rem';
                restartBtn.addEventListener('click', () => restartComponent(componentId));
                
                const diagnosticsBtn = document.createElement('button');
                diagnosticsBtn.innerText = 'Diagnostics';
                diagnosticsBtn.style.fontSize = '0.8rem';
                diagnosticsBtn.style.padding = '0.25rem 0.5rem';
                diagnosticsBtn.style.marginLeft = '0.5rem';
                diagnosticsBtn.addEventListener('click', () => runComponentDiagnostics(componentId));
                
                controlsDiv.appendChild(restartBtn);
                controlsDiv.appendChild(diagnosticsBtn);
                componentItem.appendChild(controlsDiv);
                
                componentList.appendChild(componentItem);
            }
        }
        
        // Update system metrics panel
        function updateSystemMetricsPanel(data) {
            if (!data) return;
            
            // Update status indicator
            updatePanelStatus('system-metrics-status', data.status || 'unknown');
            
            // Update metric values
            if (data.metrics && data.metrics.current) {
                const current = data.metrics.current;
                
                // Update CPU usage
                if (current.cpu) {
                    document.getElementById('cpu-usage').innerText = `${Math.round(current.cpu.total_percent)}%`;
                }
                
                // Update memory usage
                if (current.memory) {
                    document.getElementById('memory-usage').innerText = `${Math.round(current.memory.total_percent)}%`;
                    document.getElementById('process-memory').innerText = `${Math.round(current.memory.process_mb)} MB`;
                }
                
                // Update disk usage
                if (current.disk) {
                    document.getElementById('disk-usage').innerText = `${Math.round(current.disk.percent)}%`;
                }
            }
            
            // Update charts
            if (data.metrics && data.metrics.history) {
                updateMetricsCharts(data.metrics.history);
            }
        }
        
        // Update memory access panel
        function updateMemoryAccessPanel(data) {
            if (!data) return;
            
            // Update status indicator
            updatePanelStatus('memory-access-status', data.status || 'unknown');
            
            // Update memory tier counts
            if (data.stats) {
                document.getElementById('short-term-count').innerText = data.stats.short_term_count || '-';
                document.getElementById('mid-term-count').innerText = data.stats.mid_term_count || '-';
                document.getElementById('long-term-count').innerText = data.stats.long_term_count || '-';
            }
            
            // Update access logs
            const logsContainer = document.getElementById('memory-access-logs');
            logsContainer.innerHTML = '';
            
            if (data.recent_access_logs && data.recent_access_logs.length > 0) {
                data.recent_access_logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    
                    if (!log.success) {
                        logEntry.classList.add('log-error');
                    }
                    
                    // Format timestamp
                    const timestamp = new Date(log.timestamp);
                    const timeElement = document.createElement('div');
                    timeElement.className = 'log-time';
                    timeElement.innerText = `${timestamp.toLocaleTimeString()} - ${log.operation} on ${log.memory_tier} by ${log.agent}`;
                    
                    // Message
                    const messageElement = document.createElement('div');
                    messageElement.className = 'log-message';
                    
                    if (log.success) {
                        messageElement.innerText = `Key: ${log.key}`;
                    } else {
                        messageElement.innerText = `Error: ${log.error || 'Unknown error'} (Key: ${log.key})`;
                    }
                    
                    logEntry.appendChild(timeElement);
                    logEntry.appendChild(messageElement);
                    logsContainer.appendChild(logEntry);
                });
            } else {
                logsContainer.innerHTML = '<div class="log-entry">No recent memory operations</div>';
            }
            
            // Update error logs
            const errorLogsContainer = document.getElementById('memory-error-logs');
            errorLogsContainer.innerHTML = '';
            
            if (data.recent_error_logs && data.recent_error_logs.length > 0) {
                data.recent_error_logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry log-error';
                    
                    // Format timestamp
                    const timestamp = new Date(log.timestamp);
                    const timeElement = document.createElement('div');
                    timeElement.className = 'log-time';
                    timeElement.innerText = `${timestamp.toLocaleTimeString()} - ${log.operation} on ${log.memory_tier}`;
                    
                    // Message
                    const messageElement = document.createElement('div');
                    messageElement.className = 'log-message';
                    messageElement.innerText = log.error || 'Unknown error';
                    
                    logEntry.appendChild(timeElement);
                    logEntry.appendChild(messageElement);
                    errorLogsContainer.appendChild(logEntry);
                });
            } else {
                errorLogsContainer.innerHTML = '<div class="log-entry">No memory errors</div>';
            }
        }
        
        // Update error tracking panel
        function updateErrorTrackingPanel(data) {
            if (!data) return;
            
            // Update status indicator
            updatePanelStatus('error-tracking-status', data.status || 'unknown');
            
            // Update error counts
            if (data.error_counts) {
                document.getElementById('critical-count').innerText = data.error_counts.critical || 0;
                document.getElementById('error-count').innerText = data.error_counts.error || 0;
                document.getElementById('warning-count').innerText = data.error_counts.warning || 0;
            }
            
            // Update log file count
            if (data.monitored_logs) {
                document.getElementById('log-file-count').innerText = data.monitored_logs.length || 0;
            }
            
            // Update error logs
            const errorLogsContainer = document.getElementById('error-logs');
            errorLogsContainer.innerHTML = '';
            
            if (data.recent_errors && data.recent_errors.length > 0) {
                data.recent_errors.forEach(error => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    
                    // Add severity class
                    if (error.severity === 'critical') {
                        logEntry.classList.add('log-critical');
                    } else if (error.severity === 'error') {
                        logEntry.classList.add('log-error');
                    } else if (error.severity === 'warning') {
                        logEntry.classList.add('log-warning');
                    }
                    
                    // Format timestamp
                    const timestamp = new Date(error.timestamp);
                    const timeElement = document.createElement('div');
                    timeElement.className = 'log-time';
                    timeElement.innerText = `${timestamp.toLocaleTimeString()} - ${error.component} (${error.log_file})`;
                    
                    // Message
                    const messageElement = document.createElement('div');
                    messageElement.className = 'log-message';
                    messageElement.innerText = error.message || 'Unknown error';
                    
                    logEntry.appendChild(timeElement);
                    logEntry.appendChild(messageElement);
                    errorLogsContainer.appendChild(logEntry);
                });
            } else {
                errorLogsContainer.innerHTML = '<div class="log-entry">No recent errors</div>';
            }
        }
        
        // Update panel status indicator
        function updatePanelStatus(elementId, status) {
            const indicator = document.getElementById(elementId);
            if (!indicator) return;
            
            // Remove all status classes
            indicator.className = 'status-indicator';
            
            // Add appropriate class
            switch (status) {
                case 'running':
                    indicator.classList.add('status-running');
                    break;
                case 'warning':
                    indicator.classList.add('status-warning');
                    break;
                case 'error':
                    indicator.classList.add('status-error');
                    break;
                case 'critical':
                    indicator.classList.add('status-critical');
                    break;
                default:
                    indicator.classList.add('status-unknown');
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // CPU usage chart
            const cpuCtx = document.createElement('canvas');
            document.getElementById('cpu-chart').appendChild(cpuCtx);
            
            config.charts.cpu = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage (%)',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#e0e0e0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e0e0e0',
                                maxRotation: 0
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    }
                }
            });
            
            // Memory usage chart
            const memCtx = document.createElement('canvas');
            document.getElementById('memory-chart').appendChild(memCtx);
            
            config.charts.memory = new Chart(memCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Memory Usage (%)',
                        data: [],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Process Memory (MB)',
                        data: [],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#e0e0e0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            position: 'right',
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#e0e0e0'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e0e0e0',
                                maxRotation: 0
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    }
                }
            });
        }
        
        // Update charts with new data
        function updateMetricsCharts(history) {
            // Update CPU chart
            if (history.cpu && history.cpu.length > 0) {
                const cpuData = history.cpu.map(item => item.total_percent);
                const timestamps = history.cpu.map(item => {
                    const date = new Date(item.timestamp);
                    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                });
                
                config.charts.cpu.data.labels = timestamps;
                config.charts.cpu.data.datasets[0].data = cpuData;
                config.charts.cpu.update();
            }
            
            // Update Memory chart
            if (history.memory && history.memory.length > 0) {
                const memData = history.memory.map(item => item.total_percent);
                const processData = history.memory.map(item => item.process_mb);
                const timestamps = history.memory.map(item => {
                    const date = new Date(item.timestamp);
                    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                });
                
                config.charts.memory.data.labels = timestamps;
                config.charts.memory.data.datasets[0].data = memData;
                config.charts.memory.data.datasets[1].data = processData;
                config.charts.memory.update();
            }
        }
        
        // Toggle panel visibility
        function togglePanel(panelId, buttonElement) {
            const panel = document.getElementById(panelId);
            const content = panel.querySelector('.panel-content');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                buttonElement.innerText = 'Collapse';
            } else {
                content.style.display = 'none';
                buttonElement.innerText = 'Expand';
            }
        }
        
        // Run system diagnostics
        async function runDiagnostics() {
            try {
                const response = await fetch(`${config.apiEndpoint}/dashboard/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: 'run_diagnostics'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Diagnostics complete. Status: ${result.data.status}\n\nIssues: ${result.data.issues ? result.data.issues.join('\n') : 'None'}\n\nWarnings: ${result.data.warnings ? result.data.warnings.join('\n') : 'None'}`);
                    
                    // Refresh dashboard data
                    fetchDashboardData();
                } else {
                    alert('Error running diagnostics');
                }
            } catch (error) {
                console.error('Error running diagnostics:', error);
                alert('Error running diagnostics: ' + error.message);
            }
        }
        
        // Run component-specific diagnostics
        async function runComponentDiagnostics(componentId) {
            try {
                const response = await fetch(`${config.apiEndpoint}/dashboard/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: 'run_diagnostics',
                        params: {
                            component_id: componentId
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Diagnostics for ${componentId} complete. Status: ${result.data.status}\n\nIssues: ${result.data.issues ? result.data.issues.join('\n') : 'None'}\n\nWarnings: ${result.data.warnings ? result.data.warnings.join('\n') : 'None'}`);
                    
                    // Refresh dashboard data
                    fetchDashboardData();
                } else {
                    alert('Error running component diagnostics');
                }
            } catch (error) {
                console.error('Error running component diagnostics:', error);
                alert('Error running component diagnostics: ' + error.message);
            }
        }
        
        // Restart a component
        async function restartComponent(componentId) {
            if (!confirm(`Are you sure you want to restart the ${componentId} component?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${config.apiEndpoint}/dashboard/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: 'restart_component',
                        params: {
                            component_id: componentId
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Component ${componentId} restart: ${result.data.success ? 'Success' : 'Failed'}\n${result.data.message || ''}`);
                    
                    // Refresh dashboard data
                    fetchDashboardData();
                } else {
                    alert('Error restarting component');
                }
            } catch (error) {
                console.error('Error restarting component:', error);
                alert('Error restarting component: ' + error.message);
            }
        }
        
        // Clear error logs
        async function clearErrors() {
            if (!confirm('Are you sure you want to clear all error logs?')) {
                return;
            }
            
            try {
                const response = await fetch(`${config.apiEndpoint}/dashboard/command`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: 'clear_errors'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('Error logs cleared successfully');
                    
                    // Refresh dashboard data
                    fetchDashboardData();
                } else {
                    alert('Error clearing error logs');
                }
            } catch (error) {
                console.error('Error clearing error logs:', error);
                alert('Error clearing error logs: ' + error.message);
            }
        }
    </script>
</body>
</html>